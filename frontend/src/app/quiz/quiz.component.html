<div class="quiz-container">
  <div class="quiz-header">
    <button class="back-button" (click)="goBackToOptions()">
      â† Retour
    </button>
    <h2>ğŸ“ Quiz IA - Cours {{ courseNumber }} - Partie {{ partNumber }}</h2>
  </div>

  <div class="quiz-messages" #messagesContainer>
    <div *ngFor="let message of messages"
         class="message"
         [ngClass]="message.role === 'user' ? 'message-user' : 'message-bot'">
      <div class="message-icon">
        {{ message.role === 'user' ? 'ğŸ‘¤' : 'ğŸ¤–' }}
      </div>
      <div class="message-content">
        <pre class="message-text" [innerHTML]="formatMessageWithVideoLink(message.content)"></pre>
      </div>
    </div>

    <div *ngIf="isLoading" class="message message-bot">
      <div class="message-icon">ğŸ¤–</div>
      <div class="message-content">
        <div class="typing-indicator">
          <span></span>
          <span></span>
          <span></span>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="errorMessage" class="error-message">
    âš ï¸ {{ errorMessage }}
  </div>

  <!-- Message de fin de quiz avec recommandation vidÃ©o -->
  <div *ngIf="quizCompleted && quizScore && quizScore.percentage < 80" class="quiz-result-panel">
    <div class="result-warning">
      <h3>âš ï¸ Score insuffisant</h3>
      <p class="score-display">{{ quizScore.correct }}/{{ quizScore.total }} ({{ quizScore.percentage }}%)</p>
      <p class="threshold-message">Le seuil de maÃ®trise est de 80%.</p>

      <div class="recommendation-box">
        <h4>ğŸ“º Recommandation ImmÃ©diate</h4>
        <p>Nous vous recommandons de regarder la vidÃ©o explicative de ce cours pour mieux comprendre les concepts.</p>
        <button class="video-btn" (click)="openCourseVideo()">
          â–¶ï¸ Regarder la vidÃ©o du cours {{ courseNumber }}.{{ partNumber }}
        </button>
      </div>

      <div class="recommendation-box" style="margin-top: 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none;">
        <h4 style="color: white;">ğŸ¯ Recommandations IA PersonnalisÃ©es</h4>
        <p style="color: white;">DÃ©couvrez les cours prioritaires calculÃ©s par notre systÃ¨me GCN basÃ© sur votre profil et vos rÃ©sultats.</p>
        <button class="video-btn" (click)="goToRecommendations()" style="background: white; color: #667eea;">
          ğŸš€ Voir mes recommandations personnalisÃ©es
        </button>
      </div>
    </div>
  </div>

  <div class="quiz-input-container">
    <textarea
      [(ngModel)]="userInput"
      (keypress)="onKeyPress($event)"
      placeholder="Entrez votre rÃ©ponse ici... (Appuyez sur EntrÃ©e pour envoyer)"
      class="quiz-input"
      rows="2"
      [disabled]="isLoading"></textarea>
    <button
      (click)="sendAnswer()"
      [disabled]="!userInput.trim() || isLoading"
      class="submit-button">
      <span *ngIf="!isLoading">Envoyer â¤</span>
      <span *ngIf="isLoading">Envoi...</span>
    </button>
    <button
      (click)="restartQuiz()"
      class="restart-button"
      title="Recommencer le quiz">
      ğŸ”„
    </button>
  </div>
</div>
